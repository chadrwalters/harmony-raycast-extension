# Harmony Raycast Extension Import Analysis
Last Updated: 2025-02-06 20:44

## Part 1: "Control Harmony Hub" Command Path

### Level 0: Entry Point
File: src/control.tsx
Imports:
- "./features/control/components/HarmonyCommand"

### Level 1: Component
File: src/features/control/components/HarmonyCommand.tsx
Imports:
- External:
  - "react" (useState, useEffect)
  - "@raycast/api" (List, Icon, Action, ActionPanel, showToast, Toast, open)
- Internal:
  - "../types/harmony" (HarmonyHub, HarmonyActivity, HarmonyDevice, HarmonyCommand)
  - "../../../core/types/error" (ErrorCategory)
  - "../../../core/logging/errorHandler" (ErrorHandler)
  - "../../../core/harmony/harmonyClient" (HarmonyManager)
  - "../../../core/logging/logger" (Logger)
  - "../hooks/useHarmony" (useHarmony)

### Level 2: Hook
File: src/features/control/hooks/useHarmony.ts
Imports:
- External:
  - "react" (useState, useEffect, useCallback)
- Internal:
  - "../../../core/session/session-manager" (SessionManager)
  - "../../../core/logging/errorHandler" (ErrorHandler, ErrorCategory)
  - "../../../core/ui/toast-manager" (ToastManager)
  - "../../../core/utils/performance" (measureAsync)
  - "../../../core/harmony/harmonyClient" (HarmonyManager)
  - "../../../core/logging/logger" (Logger)
  - "../types/harmony" (HarmonyHub, HarmonyActivity, HarmonyDevice)

### Level 3: Core Services

#### Session Manager
File: src/core/session/session-manager.ts
Imports:
- External:
  - "@raycast/api" (LocalStorage)
- Internal:
  - "../ui/toast-manager" (ToastManager)

#### Toast Manager
File: src/core/ui/toast-manager.ts
Imports:
- External:
  - "@raycast/api" (Toast, showToast)
- Internal: none

#### Performance Utils
File: src/core/utils/performance.ts
Imports:
- External:
  - "@raycast/api" (Toast, showToast)
- Internal: none

#### Error Handler
File: src/core/logging/errorHandler.ts
Imports:
- External: none
- Internal:
  - "../ui/toast-manager" (ToastManager)
  - "../session/session-manager" (SessionManager)
  - "./logger" (Logger)
  - "../../types/error" (ErrorCategory)

#### Logger
File: src/core/logging/logger.ts
Imports:
- External:
  - "@raycast/api" (environment, getPreferenceValues)
- Internal: none

#### Harmony Client
File: src/core/harmony/harmonyClient.ts
Imports:
- External:
  - "@raycast/api" (getPreferenceValues, environment)
  - "events" (EventEmitter)
  - "@harmonyhub/client-ws" (HarmonyClient, getHarmonyClient)
  - "@harmonyhub/discover" (Explorer)
  - "os" (networkInterfaces)
- Internal:
  - "../logging/logger" (Logger)
  - "../types/harmony" (HarmonyHub, HarmonyDevice, HarmonyActivity, CachedHarmonyData)
  - "../types/error" (ErrorCategory)
  - "../logging/errorHandler" (ErrorHandler)
  - "../storage/secure-storage" (SecureStorage)
  - "../session/session-manager" (SessionManager)
  - "../ui/toast-manager" (ToastManager)
  - "../utils/performance" (measureAsync)

#### Secure Storage
File: src/core/storage/secure-storage.ts
Imports:
- External:
  - "@raycast/api" (LocalStorage)
  - "crypto" (node built-in)
- Internal:
  - "../logging/errorHandler" (ErrorHandler)
  - "../types/error" (ErrorCategory)

### Level 4: Types

#### Harmony Types
File: src/features/control/types/harmony.ts
Imports: none
Defines:
- HarmonyHub
- HarmonyDevice
- HarmonyCommand
- HarmonyActivity
- ActivityStatus
- HarmonyState
- CachedHarmonyData
- HarmonyResponse

#### Error Types
File: src/core/types/error.ts
Imports: none
Defines:
- ErrorCategory enum

## Complete File List for Working Command Path
1. Entry: src/control.tsx
2. Component: src/features/control/components/HarmonyCommand.tsx
3. Hook: src/features/control/hooks/useHarmony.ts
4. Types:
   - src/features/control/types/harmony.ts
   - src/core/types/error.ts
5. Core Services:
   - src/core/session/session-manager.ts
   - src/core/ui/toast-manager.ts
   - src/core/utils/performance.ts
   - src/core/logging/errorHandler.ts
   - src/core/logging/logger.ts
   - src/core/harmony/harmonyClient.ts
   - src/core/storage/secure-storage.ts

## External Dependencies
1. NPM Packages:
   - @raycast/api
   - @harmonyhub/client-ws
   - @harmonyhub/discover
   - react
2. Node.js Built-ins:
   - events
   - os
   - crypto

## Part 2: "Settings" Command Path

### Level 0: Entry Point
File: src/settings.tsx
Imports:
- External:
  - "@raycast/api" (Form, ActionPanel, Action, showToast, Toast, LocalStorage)
  - "react" (useEffect, useState)
- Internal:
  - "./hooks/useHarmony" (useHarmony)

### Level 1: Hook
File: src/hooks/useHarmony.ts
Imports:
- External:
  - "react" (useState, useCallback)
- Internal:
  - "../lib/sessionManager" (SessionManager)
  - "../lib/errorHandler" (ErrorHandler, ErrorCategory)
  - "../lib/toastManager" (ToastManager)
  - "../lib/performance" (measureAsync)
  - "../lib/harmonyClient" (HarmonyManager)
  - "../lib/logger" (Logger)

### Level 2: Core Services (Old Path)
Note: These are duplicates of files we found in the Control command path, but located in different directories

#### Session Manager
File: src/lib/sessionManager.ts
(Duplicate of functionality in src/core/session/session-manager.ts)

#### Error Handler
File: src/lib/errorHandler.ts
(Duplicate of functionality in src/core/logging/errorHandler.ts)

#### Toast Manager
File: src/lib/toastManager.ts
(Duplicate of functionality in src/core/ui/toast-manager.ts)

#### Performance Utils
File: src/lib/performance.ts
(Duplicate of functionality in src/core/utils/performance.ts)

#### Harmony Client
File: src/lib/harmonyClient.ts
(Duplicate of functionality in src/core/harmony/harmonyClient.ts)

#### Logger
File: src/lib/logger.ts
(Duplicate of functionality in src/core/logging/logger.ts)

## Complete File List for Settings Command Path
1. Entry: src/settings.tsx
2. Hook: src/hooks/useHarmony.ts
3. Core Services (Old Path):
   - src/lib/sessionManager.ts
   - src/lib/errorHandler.ts
   - src/lib/toastManager.ts
   - src/lib/performance.ts
   - src/lib/harmonyClient.ts
   - src/lib/logger.ts

## External Dependencies (Additional to Control Command)
None - uses same external dependencies

## Important Findings
1. Settings command uses old file structure under src/lib/ instead of src/core/
2. All core services have duplicates:
   - New path: src/core/[service-type]/[service].ts
   - Old path: src/lib/[service].ts
3. Hook also exists in two places:
   - New path: src/features/control/hooks/useHarmony.ts
   - Old path: src/hooks/useHarmony.ts
4. Types are defined:
   - New path: Imported from dedicated type files
   - Old path: Defined directly in useHarmony.ts

---
## Notes
- [2025-02-06] Starting fresh analysis of all imports
- [2025-02-06] Tracing through core services
- [2025-02-06] Found LocalStorage dependency in session-manager
- [2025-02-06] Toast manager and performance utils have no internal dependencies
- [2025-02-06] HarmonyClient has the most dependencies, both external and internal
- [2025-02-06] Logger only depends on @raycast/api
- [2025-02-06] Error handler integrates with toast, session, and logging systems
- [2025-02-06] Found harmony types in features/control/types, not in core/types
- [2025-02-06] Type files have no dependencies themselves
- [2025-02-06] Secure storage provides encrypted LocalStorage wrapper
- [2025-02-06] Settings command uses completely parallel old structure
- [2025-02-06] Found duplicate core services in lib/ vs core/
- [2025-02-06] Settings path defines types inline instead of separate files